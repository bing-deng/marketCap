import requests
from urllib.request import urlopen,Request
import json
from datetime import datetime
import xlwt

data = xlwt.Workbook()



class Btcbox():
    
    def __init__(self,coin):
        # lower 
        self.coin = coin
        self.table = data.add_sheet(coin)
        self.table.write(0,1,u'open')
        self.table.write(0,2,u'close')
        self.table.write(0,3,u'high')
        self.table.write(0,4,u'low')
        self.table.write(0,5,u'volume')

    def data(self):

        #  https://www.btcbox.co.jp/index/tradingview/kline/coin/eth/type/history?symbol=AAPL&resolution=D&from=1578101380&to=1583282841

        # url = "https://www.btcbox.co.jp/index/tradingview/kline/coin/" +self.coin + "/type/history?symbol=AAPL&resolution=D&from=1552178781&to=1583282841"
        # # r = requests.get(url).json()
        # headers = {'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64; rv:23.0) Gecko/20100101 Firefox/23.0'}
        # req = Request(url=url, headers=headers)
        # html = urlopen(req).read()
        # print(html)

        eth = '{"t":[1582815600,1582902000,1582988400,1583074800,1583161200,1583247600,1583334000,1583420400,1583506800,1583593200,1583679600,1583766000,1583852400,1583938800,1584025200,1584111600,1584198000,1584284400,1584370800,1584457200,1584543600,1584630000,1584716400,1584802800,1584889200,1584975600,1585062000,1585148400,1585234800,1585321200,1585407600,1585494000,1585580400,1585666800],"c":["24354.00000000","24109.00000000","23866.00000000","24603.00000000","24263.00000000","23996.00000000","24573.00000000","25009.00000000","25885.00000000","23260.00000000","20362.00000000","21213.00000000","20352.00000000","14810.00000000","14160.00000000","14468.00000000","13673.00000000","12312.00000000","12539.00000000","12565.00000000","13940.00000000","16049.00000000","14631.00000000","14307.00000000","14446.00000000","15345.00000000","15188.00000000","14792.00000000","14671.00000000","14001.00000000","14010.00000000","14345.00000000","14400.00000000","14421.0000000000"],"o":["25320","24340","24121","23861","24595","24280","23990","24563","25012","25890","23278","20339","21217","20379","14810","14190","14495","13674","12298","12537","12571","13948","16046","14651","14304","14434","15362","15176","14785","14663","14001","14009","14355","14410.0000000000"],"h":["26204.00000000","25197.00000000","24692.00000000","24757.00000000","25345.00000000","24608.00000000","24999.00000000","25411.00000000","26126.00000000","26626.00000000","23458.00000000","21723.00000000","21594.00000000","21849.00000000","17063.00000000","16200.00000000","14583.00000000","14612.00000000","14649.00000000","13053.00000000","14252.00000000","17259.00000000","16633.00000000","15253.00000000","15109.00000000","15886.00000000","15818.00000000","15379.00000000","15460.00000000","14880.00000000","14404.00000000","14595.00000000","14628.00000000","14524.0000000000"],"l":["23329.00000000","23667.00000000","23427.00000000","23056.00000000","24259.00000000","23704.00000000","23782.00000000","24125.00000000","24885.00000000","23208.00000000","20232.00000000","19542.00000000","20290.00000000","13333.00000000","10000.00000000","12722.00000000","13231.00000000","11065.00000000","11654.00000000","12034.00000000","12264.00000000","13848.00000000","13055.00000000","14083.00000000","13342.00000000","14204.00000000","14816.00000000","14728.00000000","14593.00000000","13586.00000000","13612.00000000","13360.00000000","14203.00000000","14299.0000000000"],"v":["1382.57420000","1612.98500000","1025.49400000","1586.91400000","216.27380000","1572.35100000","1261.18750000","970.82180000","369.55510000","887.09220000","1481.72910000","1453.83870000","1047.24820000","1559.73890000","1789.18270000","1117.13470000","1617.61840000","1335.15240000","354.10570000","880.29670000","1459.06350000","1890.38830000","1285.16910000","539.68350000","1671.38910000","924.21600000","692.64580000","1371.63780000","1452.95540000","989.10290000","828.88580000","1038.01700000","813.63710000","85.06260000"],"s":"ok"}'

        btc = '{"t":[1582815600,1582902000,1582988400,1583074800,1583161200,1583247600,1583334000,1583420400,1583506800,1583593200,1583679600,1583766000,1583852400,1583938800,1584025200,1584111600,1584198000,1584284400,1584370800,1584457200,1584543600,1584630000,1584716400,1584802800,1584889200,1584975600,1585062000,1585148400,1585234800,1585321200,1585407600,1585494000,1585580400,1585666800],"c":["939418.00000000","933084.00000000","929153.00000000","951148.00000000","943155.00000000","939040.00000000","967819.00000000","957963.00000000","963972.00000000","908278.00000000","795000.00000000","840074.00000000","818662.00000000","648300.00000000","605310.00000000","591322.00000000","581942.00000000","547629.00000000","568221.00000000","579418.00000000","643673.00000000","737252.00000000","686662.00000000","677715.00000000","689343.00000000","738442.00000000","743133.00000000","724975.00000000","716467.00000000","677367.00000000","668000.00000000","687087.00000000","701000.00000000","691991.0000000000"],"o":["975282","939285","933472","928825","950485","943180","938047","967819","957317","964053","907700","792909","839902","819270","648300","611200","591322","583254","547424","568279","577910","643122","737387","687149","674855","691437","742121","741344","725143","717107","677762","668000","686677","700057.0000000000"],"h":["987259.00000000","951893.00000000","946509.00000000","959291.00000000","1099550.00000000","958861.00000000","1017441.00000000","977470.00000000","967671.00000000","970703.00000000","910926.00000000","855380.00000000","849995.00000000","837669.00000000","674801.00000000","636006.00000000","610000.00000000","643339.00000000","592419.00000000","600000.00000000","650000.00000000","765000.00000000","750000.00000000","730000.00000000","728741.00000000","755927.00000000","775700.00000000","752809.00000000","749148.00000000","725950.00000000","683326.00000000","693981.00000000","712732.00000000","702726.0000000000"],"l":["920000.00000000","921630.00000000","922295.00000000","913694.00000000","941956.00000000","931189.00000000","933393.00000000","955454.00000000","953683.00000000","908209.00000000","786506.00000000","784070.00000000","807759.00000000","606847.00000000","425010.00000000","540000.00000000","556435.00000000","500014.00000000","527849.00000000","544406.00000000","563405.00000000","643122.00000000","640001.00000000","662650.00000000","634305.00000000","686216.00000000","720460.00000000","717586.00000000","714471.00000000","660000.00000000","657856.00000000","634099.00000000","684428.00000000","691155.0000000000"],"v":["944.43150000","931.12420000","1155.93700000","1004.42090000","1068.12870000","994.08100000","1149.80140000","925.09500000","1135.54120000","923.68220000","383.32380000","514.77540000","323.38490000","480.73990000","508.21334000","528.49960000","456.41960000","432.72540000","392.16640000","363.54110000","162.76690000","257.81160000","127.28260000","385.39530000","407.07330000","154.30320000","487.53290000","553.42460000","690.07200000","558.66170000","842.61700000","487.16550000","405.65750000","287.64290000"],"s":"ok"}'

        ltc = '{"t":[1582815600,1582902000,1582988400,1583074800,1583161200,1583247600,1583334000,1583420400,1583506800,1583593200,1583679600,1583766000,1583852400,1583938800,1584025200,1584111600,1584198000,1584284400,1584370800,1584457200,1584543600,1584630000,1584716400,1584802800,1584889200,1584975600,1585062000,1585148400,1585234800,1585321200,1585407600,1585494000,1585580400,1585666800],"c":["6446.00000000","6333.00000000","6368.00000000","6522.00000000","6538.00000000","6470.00000000","6616.00000000","6587.00000000","6720.00000000","5993.00000000","4989.00000000","5330.00000000","4997.00000000","3721.00000000","3950.00000000","3895.00000000","3931.00000000","3668.00000000","3683.00000000","3702.00000000","4016.00000000","4658.00000000","4254.00000000","4118.00000000","4233.00000000","4393.00000000","4370.00000000","4267.00000000","4257.00000000","4108.00000000","4167.00000000","4189.00000000","4219.00000000","4245.0000000000"],"o":["6851","6444","6332","6368","6534","6538","6469","6615","6592","6689","5996","5003","5329","4997","3715","3947","3893","3932","3662","3682","3702","4018","4659","4253","4118","4227","4392","4368","4266","4257","4104","4168","4188","4219.0000000000"],"h":["7186.00000000","6655.00000000","6559.00000000","6617.00000000","7031.00000000","6989.00000000","6870.00000000","6745.00000000","6789.00000000","6762.00000000","6268.00000000","5444.00000000","5703.00000000","5541.00000000","4393.00000000","4397.00000000","4244.00000000","4176.00000000","3895.00000000","3924.00000000","4103.00000000","4853.00000000","4722.00000000","4444.00000000","4407.00000000","4531.00000000","4575.00000000","4471.00000000","4511.00000000","4428.00000000","4266.00000000","4253.00000000","4291.00000000","4258.0000000000"],"l":["6162.00000000","6201.00000000","6207.00000000","6111.00000000","6398.00000000","6413.00000000","6340.00000000","6522.00000000","6563.00000000","5930.00000000","4847.00000000","4805.00000000","4948.00000000","3170.00000000","2676.00000000","3673.00000000","3705.00000000","3331.00000000","3409.00000000","3492.00000000","3593.00000000","3883.00000000","3800.00000000","4030.00000000","3860.00000000","4122.00000000","4235.00000000","4203.00000000","4154.00000000","3976.00000000","4017.00000000","3958.00000000","4097.00000000","4133.0000000000"],"v":["297.46740000","368.64690000","859.04500000","855.09610000","756.19600000","821.40200000","695.22820000","733.28270000","572.13000000","845.52000000","758.26240000","702.12120000","724.82260000","1987.83880000","4336.65020000","563.33250000","683.80940000","1243.55010000","883.40230000","846.13300000","695.98600000","1063.07880000","618.80190000","734.26550000","2012.53090000","754.43160000","758.79600000","547.69630000","573.77020000","1647.40720000","826.25800000","890.05110000","567.09000000","235.76400000"],"s":"ok"}'

        bch = '{"t":[1582815600,1582902000,1582988400,1583074800,1583161200,1583247600,1583334000,1583420400,1583506800,1583593200,1583679600,1583766000,1583852400,1583938800,1584025200,1584111600,1584198000,1584284400,1584370800,1584457200,1584543600,1584630000,1584716400,1584802800,1584889200,1584975600,1585062000,1585148400,1585234800,1585321200,1585407600,1585494000,1585580400,1585666800],"c":["33803.00000000","33737.00000000","34021.00000000","35139.00000000","35384.00000000","34898.00000000","35856.00000000","36636.00000000","36465.00000000","32803.00000000","27548.00000000","28758.00000000","27522.00000000","20500.00000000","19007.00000000","18998.00000000","18878.00000000","18245.00000000","19471.00000000","19699.00000000","22000.00000000","26215.00000000","25546.00000000","23609.00000000","24170.00000000","25051.00000000","24791.00000000","24157.00000000","24044.00000000","22500.00000000","23115.00000000","23761.00000000","23885.00000000","23562.0000000000"],"o":["36010","34181","33737","34021","35139","35398","34898","35856","36649","36465","32803","27548","28739","27522","20500","19005","19120","18860","18966","19471","19741","22000","26218","25580","23652","24170","25051","24772","24293","24354","22632","23115","24110","23885.0000000000"],"h":["37080.00000000","35076.00000000","35498.00000000","35895.00000000","39269.00000000","37690.00000000","37458.00000000","37401.00000000","37421.00000000","36862.00000000","32803.00000000","29765.00000000","29668.00000000","29353.00000000","20771.00000000","19819.00000000","19859.00000000","20831.00000000","20816.00000000","20936.00000000","22000.00000000","31430.00000000","27200.00000000","26703.00000000","25854.00000000","26424.00000000","26442.00000000","25176.00000000","25400.00000000","24962.00000000","23649.00000000","24140.00000000","24400.00000000","23959.0000000000"],"l":["33000.00000000","32784.00000000","33089.00000000","33000.00000000","35011.00000000","34758.00000000","33934.00000000","35124.00000000","35290.00000000","32500.00000000","26877.00000000","26419.00000000","27092.00000000","20500.00000000","16574.00000000","18000.00000000","18000.00000000","17140.00000000","17889.00000000","19187.00000000","19402.00000000","22000.00000000","23000.00000000","23000.00000000","22171.00000000","24170.00000000","23811.00000000","24157.00000000","24044.00000000","22191.00000000","22134.00000000","22138.00000000","23544.00000000","23484.0000000000"],"v":["893.26010000","1030.15300000","1025.20150000","1030.09170000","1018.04500000","831.64500000","1041.80750000","1033.39380000","1023.05430000","1062.11120000","1088.08800000","1029.85080000","1030.37890000","912.13130000","336.46250000","288.09920000","1027.86480000","707.91240000","774.01990000","119.81240000","69.90140000","189.64620000","371.81940000","320.13070000","847.38130000","556.31440000","454.65940000","466.04590000","23.06160000","248.75970000","674.75640000","894.79320000","825.89190000","370.31220000"],"s":"ok"}'
        dic = {"btc":btc,"eth":eth,"ltc":ltc,"bch":bch}
        return dic[self.coin]
    def excel(self):

        r = json.loads(self.data())
        t ,c , o, l, h ,volume = r['t'][::-1], r['c'][::-1], r['o'][::-1] ,r['l'][::-1] ,r['h'][::-1] ,r['v'][::-1]

        for index, i in enumerate(t):
            d = datetime.fromtimestamp(i)
            d = str(d).replace("00:00:00","")
            hp ,lp, op, cp ,v= int(float(h[index])), int(float(l[index])), int(float(o[index])), int(float(c[index])), int(float(volume[index]))
            print(d, op, cp, hp, lp, v)
            self.table.write(index + 1,0,d)
            self.table.write(index + 1,1,op)
            self.table.write(index + 1,2,cp)
            self.table.write(index + 1,3,hp)
            self.table.write(index + 1,4,lp)
            self.table.write(index + 1,5,v)

        

if __name__ == "__main__":
    l = ["btc","eth","bch","ltc"]
    for i in l:
        bb = Btcbox(i)
        bb.excel()
    data.save("btcbox" + '.xls')